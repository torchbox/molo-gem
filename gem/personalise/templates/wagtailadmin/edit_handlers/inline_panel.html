{% load i18n %}
{% load wagtailadmin_tags  %}

{{ self.formset.management_form }}

{% if 'wagtail_personalisation_' in self.formset.prefix or 'personalise_' in self.formset.prefix %}
    {% blocktrans with heading=self.heading|lower %}
        <h2>{{ heading }}</h2>
    {% endblocktrans %}

    {% if self.formset.prefix == 'wagtail_personalisation_timerule_related' %}
        <p>
            {% blocktrans %}
                This rule is based on the time of the visit of the users.
                If they visit in between the provided period, they will be
                segmented. If the "Persistent" option is not selected, the rule
                will be only valid between the specified times.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'wagtail_personalisation_dayrule_related' %}
        <p>
            {% blocktrans %}
                This rule is very similar to the time rule, however it
                involves weekdays.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'wagtail_personalisation_referralrule_related' %}
        <p>
            {% blocktrans %}
                This rule allows you to match visitors based on the website
                they were referred from in form of a regex string, e.g.
                "example\.com|secondexample\.com|.*subdomain\.com".
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'wagtail_personalisation_visitcountrule_related' %}
        <p>
            {% blocktrans %}
               This rule allows you to segment a visitor based on
               the amount of visits per page. Use the operator to to set a
               maximum, minimum or equal amount of visits.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'wagtail_personalisation_queryrule_related' %}
        <p>
            {% blocktrans %}
               This rule lets you to set a paremeter in a URL that would
               activate the segment. You could give that link to a particular
               group of people and if they accessed it, they would be segmented,
               e.g. "http://example.com/?some_parameter=abc"
               where "some_parameter" would be the parameter and "abc" would be
               the value.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'wagtail_personalisation_devicerule_related' %}
        <p>
            {% blocktrans %}
              This rule allows to serve different content to users of different
              device types. Please remember that the detection is not always
              100% accurate.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'wagtail_personalisation_userisloggedinrule_related' %}
        <p>
            {% blocktrans %}
              This rule lets to segment content based on whether user is logged
              in.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'personalise_profiledatarule_related' %}
        <p>
            {% blocktrans %}
                Segment users based on the data filled in the profile.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'personalise_surveysubmissiondatarule_related' %}
        <p>
            {% blocktrans %}
                Tis rule allows you to segment content to users based
                on their previous answers to surveys.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'personalise_groupmembershiprule_related' %}
        <p>
            {% blocktrans %}
                Tis rule allows you to segment content to users based
                on their group membership.
            {% endblocktrans %}
        </p>
    {% endif %}

    {% if self.formset.prefix == 'personalise_commentdatarule_related' %}
        <p>
            {% blocktrans %}
                Tis rule allows you to segment content to users based
                on the comments they have submitted on the front-end.
            {% endblocktrans %}
        </p>
    {% endif %}
{% endif %}

<ul class="multiple" id="id_{{ self.formset.prefix }}-FORMS">
    {% if self.formset.non_form_errors %}
        <li class="error-message">
            {% for error in self.formset.non_form_errors %}
                <span>{{ error|escape }}</span>
            {% endfor %}
        </li>
    {% endif %}

    {% for child in self.children %}
        {% include "wagtailadmin/edit_handlers/inline_panel_child.html" %}
    {% endfor %}
</ul>

<script type="text/django-form-template" id="id_{{ self.formset.prefix }}-EMPTY_FORM_TEMPLATE">
{% escapescript %}
{% include "wagtailadmin/edit_handlers/inline_panel_child.html" with child=self.empty_child %}
{% endescapescript %}
</script>

<p class="add">
    <a class="button bicolor icon icon-plus" id="id_{{ self.formset.prefix }}-ADD">
        {% blocktrans with heading=self.heading|lower %}Add {{ heading }}{% endblocktrans %}
    </a>
</p>

{% if 'wagtail_personalisation_' in self.formset.prefix or 'personalise_' in self.formset.prefix %}
    <hr>
{% endif %}
